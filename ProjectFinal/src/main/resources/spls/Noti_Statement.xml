<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.min.noti.mapper.NotiDaoImpl">
		<insert id="notification_insert_privacy" parameterType="NotiVo">
		INSERT INTO GUN_NOTI(NOTI_ID, PROJ_NAME, GUN_NOTI.MEM_ID,NOTI_CONTENT, NOTI_NOTIFIDED, NOTI_REGDATE)
		SELECT SCHE_ID, 'privacy' ,gs.MEM_ID, SCHE_CONTENT,'N',SCHE_END 
		FROM GUN_SCHE gs
		</insert>
		
		<insert id="notification_insert_team" parameterType="NotiVo">
		INSERT INTO GUN_NOTI(NOTI_ID, PROJ_NAME, GUN_NOTI.MEM_ID,NOTI_CONTENT, NOTI_NOTIFIDED, NOTI_REGDATE)
		SELECT CONCAT(MEM_ID,WBS_ID), gp.PROJ_NAME, gp.MEM_ID, WBS_NAME, 'N', TO_CHAR(TO_DATE(WBS_END_DATE, 'mm/dd/yyyy'), 'yyyy-mm-dd')
		FROM GUN_PROJMEMLIST gp , GUN_PROJECT gp2 , GUN_DOC gd, GUN_MAIN gm , GUN_FBS gf , GUN_WBS gw 
		WHERE gp.PROJ_NAME = gp2.PROJ_NAME 
		AND gp2.PROJ_NAME = gd.PROJ_NAME 
		AND gd.DOC_ID = gm.DOC_ID 
		AND gm.TOP_ID = gf.TOP_ID
		AND gf.MID_ID = gw.MID_ID
		AND TO_CHAR(TO_DATE(WBS_END_DATE, 'mm/dd/yyyy'), 'YYYYMMDD') = TO_CHAR(SYSDATE+1,'YYYYMMDD')
		</insert>
		
		<select id="notification_my_noti"  parameterType="java.util.Map" resultType="NotiVo">
		SELECT NOTI_ID, PROJ_NAME, MEM_ID , NOTI_CONTENT , NOTI_NOTIFIDED, NOTI_REGDATE
		FROM GUN_NOTI gn
		WHERE MEM_ID = #{mem_id}
		ORDER BY NOTI_REGDATE
		</select>
		
		<select id="notification_noti_confirm" parameterType="java.util.Map" resultType="NotiVo">
		SELECT PROJ_NAME, MEM_ID , NOTI_CONTENT , NOTI_NOTIFIDED, NOTI_REGDATE
		FROM GUN_NOTI gn 
		WHERE NOTI_NOTIFIDED = 'N'
		</select>
		
		<update id="notification_update" parameterType="NotiVo">
			UPDATE GUN_NOTI SET NOTI_NOTIFIDED = 'Y'  WHERE NOTI_ID =#{noti_id}
		</update>
		
			
		<update id="notification_delete" parameterType="NotiVo">
			DELETE FROM GUN_NOTI WHERE NOTI_ID =#{noti_id}
		</update>
		
		<select id="notification_count"  parameterType="java.util.Map" resultType="Integer">
			SELECT COUNT(*)
			FROM GUN_NOTI gn  
			WHERE NOTI_NOTIFIDED = 'N' AND MEM_ID=#{mem_id}
		</select>
</mapper>
